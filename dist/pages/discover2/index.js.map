{"version":3,"sources":["pages/discover2/index.js"],"names":["app","getApp","col1H","col2H","Page","data","title","background","url","uuid","util","indicatorDots","vertical","autoplay","interval","duration","styleSeries","id","name","currentStyleSeriesId","scrollH","imgWidth","loadingCount","images","col1","col2","shortCol","artistList","userId","avatar","list","onLoad","wThis","setData","wx","getSystemInfo","success","res","ww","windowWidth","wh","windowHeight","loadImages","selectStyleSeries","e","styleSeriedId","currentTarget","dataset","onImageLoad","imageId","oImgW","detail","width","oImgH","height","scale","imgHeight","imageObj","i","length","img","push","imageDate","pic","concat","baseId","Date"],"mappings":"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","file":"index.js","sourcesContent":["// 获取全局应用程序实例对象\nconst app = getApp()\n\nlet col1H = 0;\nlet col2H = 0;\n\n// 创建页面实例对象\nPage({\n  /**\n   * 页面的初始数据\n   */\n  data: {\n    title: 'Demo page',\n    background: [\n      {url: 'http://image.artful.com.cn/artful/other/2017-12-16/6f1f61919338a534!960xAuto', uuid: app.util.uuid()},\n      {url: 'http://image.artful.com.cn/artful/other/2017-12-16/6f1f61919338a534!960xAuto', uuid: app.util.uuid()},\n      {url: 'http://image.artful.com.cn/artful/other/2017-12-16/6f1f61919338a534!960xAuto', uuid: app.util.uuid()},\n      {url: 'http://image.artful.com.cn/artful/other/2017-12-16/6f1f61919338a534!960xAuto', uuid: app.util.uuid()}\n    ],\n    indicatorDots: true,\n    vertical: true,\n    autoplay: true,\n    interval: 3000,\n    duration: 1000,\n    styleSeries: [\n      {\n        id: '123',\n        name: '现实主义'\n      },\n      {\n        id: '1234',\n        name: '现实主义'\n      },\n      {\n        id: '1235',\n        name: '现实主义'\n      },\n      {\n        id: '1236',\n        name: '现实主义'\n      },\n      {\n        id: '1237',\n        name: '现实主义'\n      },\n      {\n        id: '1238',\n        name: '现实主义'\n      },\n    ],\n    currentStyleSeriesId: '',\n\n    scrollH: 0,\n    imgWidth: 0,\n    loadingCount: 0,\n    images: [],\n    col1: [],\n    col2: [],\n    shortCol: 0,\n\n    artistList: [\n      {\n        userId: '111',\n        name: '今敏',\n        avatar: 'http://image.artful.com.cn/artful/other/2017-12-22/a6509c8747e0dfb5!960xAuto',\n        list:[\n          {\n            url: 'http://image.artful.com.cn/artful/other/2017-12-25/1a87be94254d4cd8!960xAuto',\n            id: app.util.uuid()\n          },\n          {\n            url:  'http://image.artful.com.cn/artful/other/2017-12-22/a6509c8747e0dfb5!960xAuto',\n            id: app.util.uuid()\n          },\n          {\n            url:  'http://image.artful.com.cn/artful/other/2017-12-22/30726fac9c4060d1!960xAuto',\n            id: app.util.uuid()\n          }\n        ]\n      },\n      {\n        userId: '222',\n        name: '今敏',\n        avatar: 'http://image.artful.com.cn/artful/other/2017-12-22/a6509c8747e0dfb5!960xAuto',\n        list:[\n          {\n            url: 'http://image.artful.com.cn/artful/other/2017-12-25/1a87be94254d4cd8!960xAuto',\n            id: app.util.uuid()\n          },\n          {\n            url:  'http://image.artful.com.cn/artful/other/2017-12-22/a6509c8747e0dfb5!960xAuto',\n            id: app.util.uuid()\n          },\n          {\n            url:  'http://image.artful.com.cn/artful/other/2017-12-22/30726fac9c4060d1!960xAuto',\n            id: app.util.uuid()\n          }\n        ]\n      },\n      {\n        userId: '333',\n        name: '今敏',\n        avatar: 'http://image.artful.com.cn/artful/other/2017-12-22/a6509c8747e0dfb5!960xAuto',\n        list:[\n          {\n            url: 'http://image.artful.com.cn/artful/other/2017-12-25/1a87be94254d4cd8!960xAuto',\n            id: app.util.uuid()\n          },\n          {\n            url:  'http://image.artful.com.cn/artful/other/2017-12-22/a6509c8747e0dfb5!960xAuto',\n            id: app.util.uuid()\n          },\n          {\n            url:  'http://image.artful.com.cn/artful/other/2017-12-22/30726fac9c4060d1!960xAuto',\n            id: app.util.uuid()\n          }\n        ]\n      },\n      {\n        userId: '444',\n        name: '今敏',\n        avatar: 'http://image.artful.com.cn/artful/other/2017-12-22/a6509c8747e0dfb5!960xAuto',\n        list:[\n          {\n            url: 'http://image.artful.com.cn/artful/other/2017-12-25/1a87be94254d4cd8!960xAuto',\n            id: app.util.uuid()\n          },\n          {\n            url:  'http://image.artful.com.cn/artful/other/2017-12-22/a6509c8747e0dfb5!960xAuto',\n            id: app.util.uuid()\n          },\n          {\n            url:  'http://image.artful.com.cn/artful/other/2017-12-22/30726fac9c4060d1!960xAuto',\n            id: app.util.uuid()\n          }\n        ]\n      }\n    ]\n\n  },\n\n  onLoad: function () {\n\n    let wThis = this\n    //默认选定风格\n    this.setData({currentStyleSeriesId: wThis.data.styleSeries[0].id})\n\n    //加载瀑布流\n    wx.getSystemInfo({\n      success: (res) => {\n        let ww = res.windowWidth;\n        let wh = res.windowHeight;\n        let imgWidth = ww * 0.48;\n        let scrollH = wh;\n\n        this.setData({\n          scrollH: scrollH,\n          imgWidth: imgWidth\n        });\n\n        //加载首组图片\n        this.loadImages();\n      }\n    })\n  },\n\n  //选定风格系列\n  selectStyleSeries: function (e) {\n    //todo; request\n    var styleSeriedId = e.currentTarget.dataset.id\n    this.setData({currentStyleSeriesId: styleSeriedId} )\n  },\n\n  //瀑布流\n  onImageLoad: function (e) {\n    let imageId = e.currentTarget.id;\n    let oImgW = e.detail.width;         //图片原始宽度\n    let oImgH = e.detail.height;        //图片原始高度\n    let imgWidth = this.data.imgWidth;  //图片设置的宽度\n    let scale = imgWidth / oImgW;        //比例计算\n    let imgHeight = oImgH * scale;      //自适应高度\n\n    let images = this.data.images;\n    let imageObj = null;\n\n    for (let i = 0; i < images.length; i++) {\n      let img = images[i];\n      if (img.id === imageId) {\n        imageObj = img;\n        break;\n      }\n    }\n\n    imageObj.height = imgHeight;\n\n    let loadingCount = this.data.loadingCount - 1;\n    let col1 = this.data.col1;\n    let col2 = this.data.col2;\n\n    //判断当前图片添加到左列还是右列\n    if (col1H <= col2H) {\n      col1H += imgHeight;\n      col1.push(imageObj);\n    } else {\n      col2H += imgHeight;\n      col2.push(imageObj);\n    }\n\n    let data = {\n      loadingCount: loadingCount,\n      col1: col1,\n      col2: col2\n    };\n\n    //当前这组图片已加载完毕，则清空图片临时加载区域的内容\n    if (!loadingCount) {\n      data.images = [];\n      //判断最下colHeight\n      data.shortCol =  col1H < col2H ? 0 : 1\n    }\n\n    this.setData(data);\n  },\n\n  imageDate:  [\n    { pic: \"http://image.artful.com.cn/artful/other/2017-12-16/3e8814abf1d2d370!960xAuto\", height: 0 },\n    { pic: \"http://image.artful.com.cn/artful/other/2017-12-08/6dbd9088de7404a0.jpg!960xAuto\", height: 0 },\n    { pic: \"http://image.artful.com.cn/artful/other/2017-12-16/6439ac986b55971d!960xAuto\", height: 0 },\n    { pic: \"http://image.artful.com.cn/artful/other/2017-12-08/6dbd9088de7404a0.jpg!960xAuto\", height: 0 },\n\n  ],\n\n  loadImages: function () {\n    this.imageDate = this.imageDate.concat( [\n      { pic: \"http://image.artful.com.cn/artful/other/2017-12-08/6dbd9088de7404a0.jpg!960xAuto\", height: 0 },\n      { pic: \"http://image.artful.com.cn/artful/other/2017-12-16/6439ac986b55971d!960xAuto\", height: 0 },\n      { pic: \"http://image.artful.com.cn/artful/other/2017-12-08/6dbd9088de7404a0.jpg!960xAuto\", height: 0 },\n      { pic: \"http://image.artful.com.cn/artful/other/2017-12-16/cf76da9725aade55!960xAuto\", height: 0 },\n      { pic: \"http://image.artful.com.cn/artful/other/2017-12-16/3e8814abf1d2d370!960xAuto\", height: 0 },\n\n    ])\n    let images = this.imageDate\n\n    let baseId = \"img-\" + (+new Date());\n\n    for (let i = 0; i < images.length; i++) {\n      images[i].id = baseId + \"-\" + i;\n    }\n\n    this.setData({\n      loadingCount: images.length,\n      images: images\n    });\n  }\n})\n"]}